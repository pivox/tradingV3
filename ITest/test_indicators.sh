#!/bin/bash

API_URL="http://localhost:8888"
OUTPUT_DIR="./responses"

JSON_BODY=$(cat <<EOF
{"symbol":"SOLUSDT","timeframe":"4h","klines":[{"open":151.7,"high":152.56,"low":151.7,"close":152.5,"volume":28430,"timestamp":1751572800},{"open":150.09,"high":151.94,"low":149.84,"close":151.7,"volume":270876,"timestamp":1751558400},{"open":154.45,"high":155.16,"low":149.71,"close":150.09,"volume":842776,"timestamp":1751544000},{"open":155.52,"high":156.29,"low":154.1,"close":154.45,"volume":233742,"timestamp":1751529600},{"open":153.31,"high":155.86,"low":153.13,"close":155.53,"volume":311466,"timestamp":1751515200},{"open":152.22,"high":153.96,"low":151.7,"close":153.31,"volume":180134,"timestamp":1751500800},{"open":152.92,"high":154.39,"low":151.9,"close":152.22,"volume":250884,"timestamp":1751486400},{"open":152.92,"high":153.92,"low":152.36,"close":153.55,"volume":122502,"timestamp":1751486400},{"open":151.23,"high":153.5,"low":150.28,"close":152.93,"volume":704578,"timestamp":1751472000},{"open":151.23,"high":153.5,"low":150.28,"close":152.93,"volume":704578,"timestamp":1751472000},{"open":148.54,"high":151.5,"low":147.04,"close":151.25,"volume":648720,"timestamp":1751457600},{"open":148.54,"high":151.5,"low":147.04,"close":151.25,"volume":648720,"timestamp":1751457600},{"open":149.03,"high":149.89,"low":148.35,"close":148.54,"volume":230534,"timestamp":1751443200},{"open":149.03,"high":149.89,"low":148.35,"close":148.54,"volume":230534,"timestamp":1751443200},{"open":148.79,"high":149.82,"low":148.24,"close":149.03,"volume":235352,"timestamp":1751428800},{"open":148.79,"high":149.82,"low":148.24,"close":149.03,"volume":235352,"timestamp":1751428800},{"open":146.79,"high":149.15,"low":145.77,"close":148.78,"volume":228460,"timestamp":1751414400},{"open":146.79,"high":149.15,"low":145.77,"close":148.78,"volume":228460,"timestamp":1751414400},{"open":145.37,"high":146.94,"low":144.77,"close":146.78,"volume":195782,"timestamp":1751400000},{"open":145.37,"high":146.94,"low":144.77,"close":146.78,"volume":195782,"timestamp":1751400000},{"open":147.14,"high":148.36,"low":145.24,"close":145.37,"volume":355110,"timestamp":1751385600},{"open":147.14,"high":148.36,"low":145.24,"close":145.37,"volume":355110,"timestamp":1751385600},{"open":148.75,"high":149.17,"low":145.91,"close":147.13,"volume":634158,"timestamp":1751371200},{"open":148.75,"high":149.17,"low":145.91,"close":147.13,"volume":634158,"timestamp":1751371200},{"open":149.98,"high":149.98,"low":148.06,"close":148.75,"volume":326288,"timestamp":1751356800},{"open":149.98,"high":149.98,"low":148.06,"close":148.75,"volume":326288,"timestamp":1751356800},{"open":153.85,"high":153.85,"low":148.65,"close":149.98,"volume":487436,"timestamp":1751342400},{"open":153.85,"high":153.85,"low":148.65,"close":149.98,"volume":487436,"timestamp":1751342400},{"open":154.74,"high":155.54,"low":153.08,"close":153.85,"volume":221862,"timestamp":1751328000},{"open":154.74,"high":155.54,"low":153.08,"close":153.85,"volume":221862,"timestamp":1751328000},{"open":157.76,"high":157.76,"low":154.45,"close":154.73,"volume":235614,"timestamp":1751313600},{"open":157.76,"high":157.76,"low":154.45,"close":154.73,"volume":235614,"timestamp":1751313600},{"open":157.78,"high":158.37,"low":155.29,"close":157.78,"volume":582028,"timestamp":1751299200},{"open":157.78,"high":158.37,"low":155.29,"close":157.78,"volume":582028,"timestamp":1751299200},{"open":150.27,"high":160,"low":149.65,"close":157.77,"volume":1463528,"timestamp":1751284800},{"open":150.27,"high":160,"low":149.65,"close":157.77,"volume":1463528,"timestamp":1751284800},{"open":150.58,"high":150.96,"low":149.37,"close":150.28,"volume":194294,"timestamp":1751270400},{"open":150.58,"high":150.96,"low":149.37,"close":150.28,"volume":194294,"timestamp":1751270400},{"open":151.75,"high":151.94,"low":149.66,"close":150.61,"volume":241898,"timestamp":1751256000},{"open":151.75,"high":151.94,"low":149.66,"close":150.61,"volume":241898,"timestamp":1751256000},{"open":153.22,"high":154.02,"low":151.23,"close":151.75,"volume":245058,"timestamp":1751241600},{"open":153.22,"high":154.02,"low":151.23,"close":151.75,"volume":245058,"timestamp":1751241600},{"open":151.13,"high":154.7,"low":150.34,"close":153.22,"volume":374360,"timestamp":1751227200},{"open":151.13,"high":154.7,"low":150.34,"close":153.22,"volume":374360,"timestamp":1751227200},{"open":150.69,"high":152.17,"low":149.69,"close":151.12,"volume":207380,"timestamp":1751212800},{"open":150.69,"high":152.17,"low":149.69,"close":151.12,"volume":207380,"timestamp":1751212800},{"open":151.59,"high":152.44,"low":150.64,"close":150.69,"volume":236204,"timestamp":1751198400},{"open":151.59,"high":152.44,"low":150.64,"close":150.69,"volume":236204,"timestamp":1751198400},{"open":150.26,"high":152.29,"low":149.87,"close":151.59,"volume":221572,"timestamp":1751184000},{"open":150.26,"high":152.29,"low":149.87,"close":151.59,"volume":221572,"timestamp":1751184000},{"open":149.42,"high":150.25,"low":149.3,"close":150.25,"volume":97150,"timestamp":1751169600},{"open":149.42,"high":150.25,"low":149.3,"close":150.25,"volume":97150,"timestamp":1751169600},{"open":150.66,"high":151.03,"low":149.37,"close":149.42,"volume":142592,"timestamp":1751155200},{"open":150.66,"high":151.03,"low":149.37,"close":149.42,"volume":142592,"timestamp":1751155200},{"open":150.61,"high":151.31,"low":150.01,"close":150.67,"volume":118334,"timestamp":1751140800},{"open":150.61,"high":151.31,"low":150.01,"close":150.67,"volume":118334,"timestamp":1751140800},{"open":148.1,"high":152.64,"low":148.01,"close":150.62,"volume":596242,"timestamp":1751126400},{"open":148.1,"high":152.64,"low":148.01,"close":150.62,"volume":596242,"timestamp":1751126400},{"open":147.07,"high":148.59,"low":145.82,"close":148.1,"volume":287832,"timestamp":1751112000},{"open":147.07,"high":148.59,"low":145.82,"close":148.1,"volume":287832,"timestamp":1751112000},{"open":146.52,"high":147.5,"low":145.56,"close":147.08,"volume":332136,"timestamp":1751097600},{"open":146.52,"high":147.5,"low":145.56,"close":147.08,"volume":332136,"timestamp":1751097600},{"open":143.35,"high":146.75,"low":143.01,"close":146.51,"volume":222600,"timestamp":1751083200},{"open":143.35,"high":146.75,"low":143.01,"close":146.51,"volume":222600,"timestamp":1751083200},{"open":142.05,"high":143.49,"low":141.08,"close":143.34,"volume":169880,"timestamp":1751068800},{"open":142.05,"high":143.49,"low":141.08,"close":143.34,"volume":169880,"timestamp":1751068800},{"open":141.72,"high":143.3,"low":141.56,"close":142.04,"volume":137418,"timestamp":1751054400},{"open":141.72,"high":143.3,"low":141.56,"close":142.04,"volume":137418,"timestamp":1751054400},{"open":143.4,"high":145.09,"low":140.03,"close":141.72,"volume":390646,"timestamp":1751040000},{"open":143.4,"high":145.09,"low":140.03,"close":141.72,"volume":390646,"timestamp":1751040000},{"open":142.07,"high":143.79,"low":141.07,"close":143.4,"volume":433762,"timestamp":1751025600},{"open":142.07,"high":143.79,"low":141.07,"close":143.4,"volume":433762,"timestamp":1751025600},{"open":140.27,"high":142.7,"low":140.26,"close":142.07,"volume":231948,"timestamp":1751011200},{"open":140.27,"high":142.7,"low":140.26,"close":142.07,"volume":231948,"timestamp":1751011200},{"open":141.26,"high":142.15,"low":140.13,"close":140.27,"volume":199362,"timestamp":1750996800},{"open":141.26,"high":142.15,"low":140.13,"close":140.27,"volume":199362,"timestamp":1750996800},{"open":138.99,"high":141.5,"low":137.03,"close":141.28,"volume":291516,"timestamp":1750982400},{"open":138.99,"high":141.5,"low":137.03,"close":141.28,"volume":291516,"timestamp":1750982400},{"open":142.18,"high":143.88,"low":138.54,"close":138.99,"volume":378052,"timestamp":1750968000},{"open":142.18,"high":143.88,"low":138.54,"close":138.99,"volume":378052,"timestamp":1750968000},{"open":142.92,"high":143.11,"low":140.85,"close":142.21,"volume":215422,"timestamp":1750953600},{"open":142.92,"high":143.11,"low":140.85,"close":142.21,"volume":215422,"timestamp":1750953600},{"open":143.58,"high":143.87,"low":141.29,"close":142.95,"volume":526650,"timestamp":1750939200},{"open":143.58,"high":143.87,"low":141.29,"close":142.95,"volume":526650,"timestamp":1750939200},{"open":145.07,"high":145.71,"low":143.07,"close":143.55,"volume":178654,"timestamp":1750924800},{"open":145.07,"high":145.71,"low":143.07,"close":143.55,"volume":178654,"timestamp":1750924800},{"open":145.87,"high":146.01,"low":143.97,"close":145.07,"volume":193404,"timestamp":1750910400},{"open":145.87,"high":146.01,"low":143.97,"close":145.07,"volume":193404,"timestamp":1750910400},{"open":143.48,"high":147.94,"low":143.33,"close":145.86,"volume":390530,"timestamp":1750896000},{"open":143.48,"high":147.94,"low":143.33,"close":145.86,"volume":390530,"timestamp":1750896000},{"open":144.67,"high":145.55,"low":142.25,"close":143.48,"volume":202286,"timestamp":1750881600},{"open":144.67,"high":145.55,"low":142.25,"close":143.48,"volume":202286,"timestamp":1750881600},{"open":143.6,"high":144.66,"low":142.75,"close":144.65,"volume":260040,"timestamp":1750867200},{"open":143.6,"high":144.66,"low":142.75,"close":144.65,"volume":260040,"timestamp":1750867200},{"open":146.2,"high":147.91,"low":143.06,"close":143.6,"volume":590736,"timestamp":1750852800},{"open":146.2,"high":147.91,"low":143.06,"close":143.6,"volume":590736,"timestamp":1750852800},{"open":146.95,"high":147.06,"low":144.95,"close":146.19,"volume":285196,"timestamp":1750838400},{"open":146.95,"high":147.06,"low":144.95,"close":146.19,"volume":285196,"timestamp":1750838400},{"open":145.45,"high":147.42,"low":144.79,"close":146.95,"volume":178746,"timestamp":1750824000},{"open":145.45,"high":147.42,"low":144.79,"close":146.95,"volume":178746,"timestamp":1750824000}]}
EOF
)

declare -a INDICATORS=(
  "rsi"
  "macd"
  "adx"
  "bollinger"
  "ema"
 "candle"
  "stochastic_rsi"
  "supertrend"
  "volume"
)

# CrÃ©er le dossier si non existant
mkdir -p "$OUTPUT_DIR"

for indicator in "${INDICATORS[@]}"
do
  echo "âž¡ï¸  Testing $indicator ..."

  RESPONSE=$(curl -s -X POST "$API_URL/indicator/$indicator" \
    -H "Content-Type: application/json" \
    -d "$JSON_BODY")

  OUTPUT_FILE="$OUTPUT_DIR/${indicator}_4h.json"

  # Sauvegarder la rÃ©ponse avec mise en forme (nÃ©cessite jq)
  echo "$RESPONSE" | jq . > "$OUTPUT_FILE"

  echo "âœ… $indicator â†’ $OUTPUT_FILE"
  echo "---------------------------------"

  sleep 1
done

echo "ðŸŽ¯ All indicators tested and responses saved in $OUTPUT_DIR"
